#!/bin/sh

cd "$(dirname "$0")/.." || exit 1

# Detect package manager
run_script() {
  if command -v bun >/dev/null 2>&1; then
    bun run "$1"
  elif command -v pnpm >/dev/null 2>&1; then
    pnpm run "$1"
  elif command -v yarn >/dev/null 2>&1; then
    yarn "$1"
  else
    npm run "$1"
  fi
}

# Lint TypeScript/JS (and Kotlin if available)
echo "Linting (tsc/eslint/prettier/kt)..."
run_script lint:ci || { echo "Lint failed. Aborting commit." >&2; exit 1; }

# Run tests with coverage before committing to reduce CI failures
echo "Running test coverage (pre-commit)..."
run_script test:coverage || { echo "Tests failed. Aborting commit." >&2; exit 1; }
